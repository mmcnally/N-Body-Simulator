<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  background: #222;
  font-family: sans-serif;
  font-style: italic;
}

</style>
<body>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="body.js"></script>

<script>

var spacetime = d3.select('body');
var width = 960,
    height = 500,
    radius = Math.min(width, height);

// The gravitational constant G
var G = 6.67428*Math.pow(10,-11);

// Assumed scale: 100 pixels = 1AU.
var AU = (149.6*Math.pow(10,6) * 1000);
var SCALE = 250 / AU;

//var sunBody = new Body('sun',(1.98892 * Math.pow(10,30)),[0,0],[0,0])
//var earthBody = new Body('earth',(5.9742 * Math.pow(10,24)),[0,0],[0,0])

var sunBody = new Body('sun',100,[0,0],[0,0],'rgba(255, 204, 0, 1.0)')
var earthBody = new Body('earth',10,[200,0],[1,1], 'rgba(113, 170, 255, 1.0)')

var bodies = [
  sunBody,earthBody
]
console.log(bodies);

// Space
var svg = spacetime.append("svg")
  .attr("width", width)
  .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

for (var i=0;i<bodies.length;i++){
  svg.append("circle")
    .attr("class",bodies[i].name)
    .attr("r", bodies[i].radius)
    .attr("transform", "translate(" + - bodies[i].pos[0] + "," + - bodies[i].pos[1] + ")")
    .style("fill", bodies[i].color);
}


var calcForce = function(self,other){
  var sx = self.pos[0];
  var sy = self.pos[1];
  var ox = other.pos[0];
  var oy = other.pos[1];
  var dx = (ox-sx);
  var dy = (oy-sy);

  var d = Math.sqrt(Math.pow(dx,2) + Math.pow(dy,2));

  f = G * self.mass * other.mass / (Math.pow(d,2));

  // Compute the direction of the force.
  theta = Math.atan2(dy, dx);
  f = [Math.cos(theta) * f,Math.sin(theta) * f];

  return f;
};
// Update the clock every second
setInterval(function () {

  d3.transition().tween("orbit", function () {
    return function (t) {
      for (var i=0;i<bodies.length;i++){
        var total_fx = total_fy = 0.0
        for (var j=0;j<bodies.length;j++){
          if (bodies[i].name === bodies[j].name)
            continue;
          var f = calcForce(bodies[i],bodies[j]);

          total_fx += f[0];
          total_fy += f[1];

          bodies[i].pos[0] += bodies[i].vel[0];
          bodies[i].pos[1] += bodies[i].vel[1];

          // Transition Earth
          d3.select("."+bodies[i].name)
            .attr("transform", "translate(" + - bodies[i].pos[0] + "," + - bodies[i].pos[1] + ")")
        }
      }
    };
  });
}, 16);



</script>
