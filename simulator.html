<!DOCTYPE html>
<meta charset="utf-8">
<title>N-Body-Simulator</title>
<link rel="shortcut icon" type="image/png" href="/favicon.ico"/>
<style>

body {
  background: #222;
  font-family: sans-serif;
  font-style: italic;
}
#bodySize{

}

</style>
<body>

<input id="bodySize" type="range" min="1" max="50" value="5" step=".5"></input>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>

<script>

var spacetime = d3.select('body');
var width = $(window).width()
var height = $(window).height()

// Space
var svg = spacetime.append("svg")
  .attr("id","universe")
  .attr("width", width)
  .attr("height", height)
  .append("g")
    .attr("id","observedUniverse")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

$.getJSON( "/get_all_bodies", function( data ) {
  build_all_bodies_svg(data);
});

var build_all_bodies_svg = function (data){
  for (var i=0;i<data.length;i++){
    svg.append("circle")
      .attr("id",data[i].name)
      .attr("class",data[i].name)
      .attr("r", data[i].size)
      .attr("transform", "translate(" + - data[i].px + "," + - data[i].py + ")")
      .style("fill", data[i].color);
    }
};

setInterval(function () {
      $.getJSON( "/update_all_bodies/"+$(window).width()+"/"+$(window).height(), function( data ) {

        for (var i=0;i<data.length;i++){
          $("#"+data[i].name).attr("transform", "translate(" + - data[i].px + "," + - data[i].py + ")");
        }
      });
}, 32); // 30 fps = 32, 60 fps = 16


$(window).keyup(function(e) {
  if (e.keyCode == 27) {
      $.getJSON( "/reset_bodies", function( data ) {

        for (var i=0;i<data.length;i++){
          var element = $('#'+data[i].name);
          element.remove();
        }
        $.getJSON( "/get_all_bodies", function( data ) {
          build_all_bodies_svg(data);
        });
      });
    }
});
</script>

<script>
  $(window).resize(function() {
    var width = $(window).width();
    var height = $(window).height();

    $("#universe").attr("width",width);
    $("#universe").attr("height",height);

    $("#observedUniverse").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
  })
</script>

<script>
  firstXPos = 0;
  firstYPos = 0;
  $( "#universe" ).mousedown(function() {
    firstXPos = event.pageX;
    firstYPos = event.pageY;
  });

  $( "#universe" ).mouseup(function() {
    xp = ($(window).width()/2) - firstXPos
    yp = ($(window).height()/2) - firstYPos

    var secondXPos = event.pageX;
    var secondYPos = event.pageY;

    xv = firstXPos - secondXPos
    yv = firstYPos - secondYPos

    size = document.getElementById("bodySize").value

    $.getJSON( "/add_body/"+xp+"/"+yp+"/"+xv+"/"+yv+"/"+size, function( data ) {
      svg.append("circle")
        .attr("id",data.name)
        .attr("class",data.name)
        .attr("r", data.size)
        .attr("transform", "translate(" + - data.px + "," + - data.py + ")")
        .style("fill", data.color);
    });
  });
</script>

<script>

</script>
